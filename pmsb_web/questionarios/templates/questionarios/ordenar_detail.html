{% extends "questionarios/base.html" %}

{% block conteudo %}

<div class="row">
    <div class="col-lg-12">
    <p><h5>Questionario: {{object.nome}}</h5></p>

    <p>
        <a class="btn btn-primary" href="{% url "questionarios:list" %}">Voltar</a>
        <a id="salvar_ordem" class="btn btn-success" href="#" >Salvar</a>
        <a class="btn btn-primary" href="{% url "questionarios:list" %}">Recarregar</a>
    </p>
    
    <ul id="sortable" class="list-group">
        {% for pergunta_do_questionario in object.perguntas_ordenadas %}
        <li id="{{pergunta_do_questionario.pk}}" class="list-group-item">
            <p>
                <span id="ordem_{{pergunta_do_questionario.pk}}">{{pergunta_do_questionario.ordem}}</span>
                -
                {{pergunta_do_questionario.pergunta.variavel}}:{{pergunta_do_questionario.pergunta.verbose_name_tipo}}
            </p>
            <p> 
                {{pergunta_do_questionario.pergunta.texto}}
            </p>
            {% if pergunta_do_questionario.pergunta.tipo == 0 %}
            <p>Escolhas:</p>
            {% for escolha in pergunta_do_questionario.pergunta.escolhas %}
            <p>
                {{escolha.texto}}
            {% empty%}
                Sem escolhas
            {% endfor%}
            </p>
            {% endif %}
        </li>
        {% empty %}
        <li class="list-group-item">Nenhuma pergunta</li>
        {% endfor %}
    </ul>
    </div>
</div>

{% endblock %}

{% block js %}

<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script>
$( function() {
    $("#salvar_ordem").click(function () {
        
        var children = $("#sortable").children();

        for (var i = 0; i < children.length; i++){
            
            var id = $(children[i]).attr("id");

            var old_i = parseInt($("#ordem_"+id).html()) - 1;

            var new_i = i + 1;
            update = false;
            if(i != old_i){
                $.get("{% url "questionarios:ordenar_submit" %}", {"id":id, "ordem": new_i}, function(data){
                /*
                verificar porque esta linha de codigo nÃ£o funciona aqui dentro
                $("#ordem_"+id).html(new_i); 
                */
                });
                $("#ordem_"+id).html(new_i);
            }
        }
    });

    $( "#sortable" ).sortable();
  
} );
</script>

{% endblock js %}